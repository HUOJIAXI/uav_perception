%YAML:1.0 # need to specify the file type at the top!

verbosity: "DEBUG" # ALL, DEBUG, INFO, WARNING, ERROR, SILENT

use_fej: true # if first-estimate Jacobians should be used (enable for good consistency)
integration: "rk4" # discrete, rk4, analytical (if rk4 or analytical used then analytical covariance propagation is used)
use_stereo: true # stereo mode enabled
max_cameras: 2 # 2 = stereo

calib_cam_extrinsics: false # extrinsics are known from simulation (exact)
calib_cam_intrinsics: false # intrinsics are known from simulation (exact)
calib_cam_timeoffset: false # no time offset in simulation (synchronized)
calib_imu_intrinsics: false # IMU intrinsics are ideal in simulation
calib_imu_g_sensitivity: false # no gravity sensitivity in simulation

max_clones: 11 # how many clones in the sliding window
max_slam: 50 # number of features in our state vector
max_slam_in_update: 25 # update can be split into sequential updates of batches, how many in a batch
max_msckf_in_update: 40 # how many MSCKF features to use in the update
dt_slam_delay: 1 # delay before initializing (helps with stability from bad initialization...)

gravity_mag: 9.81 # magnitude of gravity in this location

feat_rep_msckf: "GLOBAL_3D"
feat_rep_slam: "ANCHORED_MSCKF_INVERSE_DEPTH"
feat_rep_aruco: "ANCHORED_MSCKF_INVERSE_DEPTH"

# zero velocity update parameters for hovering UAV
try_zupt: true
zupt_chi2_multipler: 1 # enable both IMU and disparity-based detection
zupt_max_velocity: 0.3 # trigger ZUPT when velocity < 0.3 m/s (hovering)
zupt_noise_multiplier: 50 # stronger velocity constraint
zupt_max_disparity: 1.0 # trigger ZUPT when disparity < 1.0 pixels
zupt_only_at_beginning: false # allow ZUPT throughout flight

# ==================================================================
# ==================================================================

init_window_time: 2.0 # how many seconds to collect initialization information
init_imu_thresh: 1.0 # threshold for variance of the accelerometer to detect a "jerk" in motion
init_max_disparity: 10.0 # max disparity to consider the platform stationary (dependent on resolution)
init_max_features: 50 # how many features to track during initialization (saves on computation)

init_dyn_use: true # dynamic initialization for UAV
init_dyn_mle_opt_calib: false # do not optimize calibration during initialization
init_dyn_mle_max_iter: 50 # how many iterations the MLE refinement should use
init_dyn_mle_max_time: 0.05 # how many seconds the MLE should be completed in
init_dyn_mle_max_threads: 6 # how many threads the MLE should use
init_dyn_num_pose: 6 # number of poses to use within our window time
init_dyn_min_deg: 10.0 # orientation change needed to try to init

init_dyn_inflation_ori: 10 # what to inflate the recovered q_GtoI covariance by
init_dyn_inflation_vel: 10 # reduced to prevent velocity drift
init_dyn_inflation_bg: 10 # what to inflate the recovered bias_g covariance by
init_dyn_inflation_ba: 10 # reduced to constrain accel bias drift
init_dyn_min_rec_cond: 1e-12 # reciprocal condition number thresh for info inversion

init_dyn_bias_g: [ 0.0, 0.0, 0.0 ] # initial gyroscope bias guess
init_dyn_bias_a: [ 0.0, 0.0, 0.0 ] # initial accelerometer bias guess

# ==================================================================
# ==================================================================

record_timing_information: false
record_timing_filepath: "/tmp/traj_timing.txt"

save_total_state: false
filepath_est: "/tmp/ov_estimate.txt"
filepath_std: "/tmp/ov_estimate_std.txt"
filepath_gt: "/tmp/ov_groundtruth.txt"

# ==================================================================
# ==================================================================

# front-end feature tracking parameters
use_klt: true
num_pts: 300 # increased for more visual constraints (stereo benefits from dense features)
fast_threshold: 15 # lowered to extract more features
grid_x: 7 # denser feature distribution
grid_y: 7 # denser feature distribution
min_px_dist: 10 # distance between features
knn_ratio: 0.70 # descriptor knn threshold
track_frequency: 30.0 # match camera FPS from Isaac Sim
downsample_cameras: false # 640x480 is already manageable
num_opencv_threads: 4
histogram_method: "HISTOGRAM"

# aruco tag tracker
use_aruco: false
num_aruco: 1024
downsize_aruco: true

# ==================================================================
# ==================================================================

# camera noises and chi-squared threshold multipliers
up_msckf_sigma_px: 1
up_msckf_chi2_multipler: 1
up_slam_sigma_px: 1
up_slam_chi2_multipler: 1
up_aruco_sigma_px: 1
up_aruco_chi2_multipler: 1

# masks for our images
use_mask: false

# imu and camera spacial-temporal
relative_config_imu: "kalibr_imu_chain.yaml"
relative_config_imucam: "kalibr_imucam_chain.yaml"
