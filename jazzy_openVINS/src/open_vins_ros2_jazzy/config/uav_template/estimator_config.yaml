%YAML:1.0 # need to specify the file type at the top!

# ========================================================================
# OpenVINS UAV Template Configuration
# ========================================================================
# This is a template for monocular camera + IMU setup
# Replace placeholders with your actual values

verbosity: "INFO" # ALL, DEBUG, INFO, WARNING, ERROR, SILENT

use_fej: true # if first-estimate Jacobians should be used (enable for good consistency)
integration: "rk4" # discrete, rk4, analytical
use_stereo: false # MUST be false for monocular
max_cameras: 1 # MUST be 1 for monocular

# ========================================================================
# Calibration Options
# ========================================================================
calib_cam_extrinsics: true # if the transform between camera and IMU should be optimized
calib_cam_intrinsics: true # if camera intrinsics should be optimized
calib_cam_timeoffset: true # if timeoffset between camera and IMU should be optimized
calib_imu_intrinsics: false # if imu intrinsics should be calibrated
calib_imu_g_sensitivity: false # if gyroscope gravity sensitivity should be calibrated

# ========================================================================
# State Vector Configuration
# ========================================================================
max_clones: 11 # how many clones in the sliding window
max_slam: 50 # number of features in our state vector
max_slam_in_update: 25 # update can be split into batches
max_msckf_in_update: 40 # how many MSCKF features to use in the update
dt_slam_delay: 1 # delay before initializing SLAM features

# ========================================================================
# Physical Constants
# ========================================================================
# ADJUST THIS: gravity magnitude at your location (usually 9.80 - 9.82 m/s^2)
gravity_mag: 9.81

# ========================================================================
# Feature Representation
# ========================================================================
feat_rep_msckf: "GLOBAL_3D"
feat_rep_slam: "ANCHORED_MSCKF_INVERSE_DEPTH"
feat_rep_aruco: "ANCHORED_MSCKF_INVERSE_DEPTH"

# ========================================================================
# Zero Velocity Update (ZUPT)
# ========================================================================
# Useful if UAV is stationary for periods
try_zupt: false
zupt_chi2_multipler: 0
zupt_max_velocity: 0.1
zupt_noise_multiplier: 10
zupt_max_disparity: 0.5
zupt_only_at_beginning: false

# ========================================================================
# Initialization Parameters
# ========================================================================
init_window_time: 2.0 # seconds to collect initialization information
init_imu_thresh: 1.5 # threshold for variance of accelerometer to detect motion
init_max_disparity: 10.0 # max disparity to consider platform stationary
init_max_features: 50 # how many features to track during initialization

# Dynamic initialization (RECOMMENDED for UAVs in motion)
init_dyn_use: true # enable dynamic initialization
init_dyn_mle_opt_calib: false # optimize calibration during initialization (not recommended)
init_dyn_mle_max_iter: 50
init_dyn_mle_max_time: 0.05
init_dyn_mle_max_threads: 6
init_dyn_num_pose: 6 # number of poses within window
init_dyn_min_deg: 10.0 # minimum rotation required to initialize (degrees)

# Covariance inflation for dynamic initialization
init_dyn_inflation_ori: 10
init_dyn_inflation_vel: 100
init_dyn_inflation_bg: 10
init_dyn_inflation_ba: 100
init_dyn_min_rec_cond: 1e-12

# Initial bias guess (usually [0.0, 0.0, 0.0])
init_dyn_bias_g: [0.0, 0.0, 0.0] # initial gyroscope bias
init_dyn_bias_a: [0.0, 0.0, 0.0] # initial accelerometer bias

# ========================================================================
# Recording/Logging
# ========================================================================
record_timing_information: false
record_timing_filepath: "/tmp/traj_timing.txt"

save_total_state: false
filepath_est: "/tmp/ov_estimate.txt"
filepath_std: "/tmp/ov_estimate_std.txt"
filepath_gt: "/tmp/ov_groundtruth.txt"

# ========================================================================
# Feature Tracking Parameters
# ========================================================================
use_klt: true # KLT tracking (recommended over descriptor-based)
num_pts: 200 # number of features to track per camera
fast_threshold: 20 # threshold for FAST feature extraction (lower = more features)
grid_x: 5 # grid cells for uniform feature distribution
grid_y: 5
min_px_dist: 10 # minimum pixel distance between features
knn_ratio: 0.70 # descriptor KNN threshold (only if use_klt: false)
track_frequency: 21.0 # feature tracking frequency (Hz)
downsample_cameras: false # downsample images by half
num_opencv_threads: 4 # OpenCV threads (-1: auto, 0-1: serial, >1: parallel)
histogram_method: "HISTOGRAM" # NONE, HISTOGRAM, CLAHE

# ========================================================================
# ArUco Marker Tracking
# ========================================================================
use_aruco: false
num_aruco: 1024
downsize_aruco: true

# ========================================================================
# Update Parameters
# ========================================================================
# Camera measurement noise and chi-squared test multipliers
up_msckf_sigma_px: 1
up_msckf_chi2_multipler: 1
up_slam_sigma_px: 1
up_slam_chi2_multipler: 1
up_aruco_sigma_px: 1
up_aruco_chi2_multipler: 1

# ========================================================================
# Image Masks
# ========================================================================
use_mask: false
# If using masks, specify relative paths to mask images:
# mask0: "mask_cam0.png"

# ========================================================================
# Configuration File References
# ========================================================================
relative_config_imu: "kalibr_imu_chain.yaml"
relative_config_imucam: "kalibr_imucam_chain.yaml"
